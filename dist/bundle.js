(()=>{"use strict";class e{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}function t(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<e.max),t}function n(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class i extends class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new i),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.updateStateListener()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!=t&&(n.status=t,this.updateStateListener())}updateStateListener(){for(const e of this.listeners)e(this.projects.slice())}}const l=i.getInstance();class o extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const e=this.titleInputElement.value,n=this.descriptionInputElement.value,r=this.peopleInputElement.value,s={value:n,required:!0,minLength:5},i={value:+r,required:!0,min:0,max:5};return t({value:e,required:!0})&&t(s)&&t(i)?[e,n,+r]:void alert("validation failed! try again")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;console.log(e,n,r),l.addProject(e,n,r),this.clearInputs()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],o.prototype,"submitHandler",null);var a=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class c extends e{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 person":this.project.people+" persons"}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+"  assigned",this.element.querySelector("p").textContent=this.project.description}}a([n],c.prototype,"dragStartHandler",null),a([n],c.prototype,"dragEndHandler",null);var d=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class p extends e{constructor(e){super("project-list","app",!1,e+"-projects"),this.type=e,this.assignedProjects=[],this.element.id=this.type+"-projects",this.configure(),this.renderContent()}renderProjects(){document.getElementById(this.type+"-projects-list").innerHTML="";for(const e of this.assignedProjects)new c(this.element.querySelector("ul").id,e)}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const t=e.dataTransfer.getData("text/plain");l.moveProject(t,"active"===this.type?r.Active:r.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),l.addListener((e=>{this.assignedProjects=e.filter((e=>"active"===this.type?e.status===r.Active:e.status===r.Finished)),this.renderProjects()}))}renderContent(){const e=this.type+"-projects-list";this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}}d([n],p.prototype,"dragOverHandler",null),d([n],p.prototype,"dropHandler",null),d([n],p.prototype,"dragLeaveHandler",null),new o,new p("active"),new p("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90eXBlc2NyaXB0LWNvdXJzZS8uL3NyYy9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50LnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtY291cnNlLy4vc3JjL3V0aWwvdmFsaWRhdGlvbi50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LWNvdXJzZS8uL3NyYy9kZWNvcmF0b3JzL2F1dG9iaW5kLWRlY29yYXRvci50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LWNvdXJzZS8uL3NyYy9tb2RlbHMvcHJvamVjdC1tb2RlbC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LWNvdXJzZS8uL3NyYy9zdGF0ZS9wcm9qZWN0LXN0YXRlLnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtY291cnNlLy4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LWNvdXJzZS8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtaXRlbS50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LWNvdXJzZS8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LWNvdXJzZS8uL3NyYy9hcHAudHMiXSwibmFtZXMiOlsiQ29tcG9uZW50IiwidGVtcGxhdGVJRCIsImhvc3RFbGVtZW50SWQiLCJpbnNlcnRBdFN0YXJ0IiwibmV3RWxlbWVudElkIiwidGhpcyIsInRlbXBsYXRlRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJob3N0RWxlbWVudCIsImltcG9ydE5vZGUiLCJjb250ZW50IiwiZWxlbWVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiaWQiLCJhdHRhY2giLCJpbnNlcnRBdEJlZ2lubmluZyIsImluc2VydEFkamFjZW50RWxlbWVudCIsInZhbGlkYXRlIiwidmFsaWRhdGFibGVJbnB1dCIsImlzVmFsaWQiLCJyZXF1aXJlZCIsInZhbHVlIiwidG9TdHJpbmciLCJ0cmltIiwibGVuZ3RoIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwibWluIiwibWF4IiwiYXV0b2JpbmQiLCJfIiwiXzIiLCJkZXNjcmlwdG9yIiwib3JpZ2luYWxNZXRob2QiLCJjb25maWd1cmFibGUiLCJiaW5kIiwiUHJvamVjdFN0YXR1cyIsIlByb2plY3QiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwicGVvcGxlIiwic3RhdHVzIiwiUHJvamVjdFN0YXRlIiwibGlzdGVuZXJzIiwibGlzdGVuZXJGbiIsInB1c2giLCJzdXBlciIsInByb2plY3RzIiwiaW5zdGFuY2UiLCJudW1PZlBlb3BsZSIsIm5ld1Byb2plY3QiLCJNYXRoIiwicmFuZG9tIiwiQWN0aXZlIiwidXBkYXRlU3RhdGVMaXN0ZW5lciIsInByb2plY3RJRCIsIm5ld1N0YXR1cyIsInByb2plY3QiLCJmaW5kIiwicHJqIiwic2xpY2UiLCJwcm9qZWN0U3RhdGUiLCJnZXRJbnN0YW5jZSIsIlByb2plY3RJbnB1dCIsInRpdGxlSW5wdXRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImRlc2NyaXB0aW9uSW5wdXRFbGVtZW50IiwicGVvcGxlSW5wdXRFbGVtZW50IiwiY29uZmlndXJlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN1Ym1pdEhhbmRsZXIiLCJlbnRlcmVkVGl0bGUiLCJlbnRlcmVkRGVzY3JpcHRpb24iLCJlbnRlcmVkUGVvcGxlIiwiZGVzY3JpcHRpb25WYWxpZGF0ZSIsInBlb3BsZVZhbGlkYXRlIiwiYWxlcnQiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidXNlcklucHV0IiwiZ2F0aGVyVXNlcklucHV0IiwiQXJyYXkiLCJpc0FycmF5IiwiZGVzYyIsImNvbnNvbGUiLCJsb2ciLCJhZGRQcm9qZWN0IiwiY2xlYXJJbnB1dHMiLCJQcm9qZWN0SXRlbSIsImhvc3RJZCIsInJlbmRlckNvbnRlbnQiLCJkYXRhVHJhbnNmZXIiLCJzZXREYXRhIiwiZWZmZWN0QWxsb3dlZCIsImRyYWdTdGFydEhhbmRsZXIiLCJkcmFnRW5kSGFuZGxlciIsInRleHRDb250ZW50IiwicGVyc29ucyIsIlByb2plY3RMaXN0IiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJpbm5lckhUTUwiLCJwcmpJdGVtIiwidHlwZXMiLCJjbGFzc0xpc3QiLCJhZGQiLCJwcmpJZCIsImdldERhdGEiLCJtb3ZlUHJvamVjdCIsIkZpbmlzaGVkIiwicmVtb3ZlIiwiZHJhZ092ZXJIYW5kbGVyIiwiZHJhZ0xlYXZlSGFuZGxlciIsImRyb3BIYW5kbGVyIiwiYWRkTGlzdGVuZXIiLCJmaWx0ZXIiLCJyZW5kZXJQcm9qZWN0cyIsImxpc3RJZCIsInRvVXBwZXJDYXNlIl0sIm1hcHBpbmdzIjoibUJBR21CLE1BQWVBLEVBSzFCLFlBQVlDLEVBQW9CQyxFQUF1QkMsRUFBd0JDLEdBQzNFQyxLQUFLQyxnQkFBa0JDLFNBQVNDLGVBQWVQLEdBQy9DSSxLQUFLSSxZQUFlRixTQUFTQyxlQUFlTixHQUU1QyxNQUFNUSxFQUFhSCxTQUFTRyxXQUFXTCxLQUFLQyxnQkFBZ0JLLFNBQVMsR0FDckVOLEtBQUtPLFFBQVVGLEVBQVdHLGtCQUN0QlQsSUFDSEMsS0FBS08sUUFBUUUsR0FBSVYsR0FHbEJDLEtBQUtVLE9BQU9aLEdBR1IsT0FBUWEsR0FDWlgsS0FBS0ksWUFBWVEsc0JBQXNCRCxFQUFvQixhQUFlLFlBQWFYLEtBQUtPLFVDWjdGLFNBQVNNLEVBQVNDLEdBQ3JCLElBQUlDLEdBQVUsRUFnQmQsT0FmR0QsRUFBaUJFLFdBQ2hCRCxFQUFVQSxHQUErRCxJQUFwREQsRUFBaUJHLE1BQU1DLFdBQVdDLE9BQU9DLFFBRWxDLE1BQTdCTixFQUFpQk8sV0FBcUQsaUJBQTFCUCxFQUFpQkcsUUFDNURGLEVBQVVBLEdBQVdELEVBQWlCRyxNQUFNRyxPQUFTTixFQUFpQk8sV0FFMUMsTUFBN0JQLEVBQWlCUSxXQUFxRCxpQkFBMUJSLEVBQWlCRyxRQUM1REYsRUFBVUEsR0FBV0QsRUFBaUJHLE1BQU1HLE9BQVNOLEVBQWlCUSxXQUUvQyxNQUF4QlIsRUFBaUJTLEtBQWdELGlCQUExQlQs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TUFBT3BELEdBQUl5RixHQUs5RCxnQkFBZ0J6QixHQUNUQSxFQUFNYyxjQUFnRCxlQUFoQ2QsRUFBTWMsYUFBYVksTUFBTSxLQUM5QzFCLEVBQU1DLGlCQUNTMUUsS0FBS08sUUFBUXNELGNBQWMsTUFDbkN1QyxVQUFVQyxJQUFJLGNBSTdCLFlBQVk1QixHQUNSLE1BQU02QixFQUFTN0IsRUFBTWMsYUFBY2dCLFFBQVEsY0FDM0M5QyxFQUFhK0MsWUFBWUYsRUFBcUIsV0FBZHRHLEtBQUsrRixLQUFvQi9ELEVBQWNpQixPQUFTakIsRUFBY3lFLFVBSWxHLGlCQUFpQi9FLEdBRUUxQixLQUFLTyxRQUFRc0QsY0FBYyxNQUNuQ3VDLFVBQVVNLE9BQU8sYUFLNUIsWUFDSTFHLEtBQUtPLFFBQVEwRCxpQkFBaUIsV0FBWWpFLEtBQUsyRyxpQkFDL0MzRyxLQUFLTyxRQUFRMEQsaUJBQWlCLFlBQWFqRSxLQUFLNEcsa0JBQ2hENUcsS0FBS08sUUFBUTBELGlCQUFpQixPQUFRakUsS0FBSzZHLGFBRTNDcEQsRUFBYXFELGFBQWFuRSxJQUN0QjNDLEtBQUtnRyxpQkFBbUJyRCxFQUFTb0UsUUFBT3hELEdBQ25CLFdBQWR2RCxLQUFLK0YsS0FDR3hDLEVBQUlsQixTQUFXTCxFQUFjaUIsT0FFakNNLEVBQUlsQixTQUFXTCxFQUFjeUUsV0FHeEN6RyxLQUFLZ0gsb0JBSWIsZ0JBQ0ksTUFBTUMsRUFBWWpILEtBQUsrRixLQUFSLGlCQUNmL0YsS0FBS08sUUFBUXNELGNBQWMsTUFBT3BELEdBQUt3RyxFQUN2Q2pILEtBQUtPLFFBQVFzRCxjQUFjLE1BQU8rQixZQUFjNUYsS0FBSytGLEtBQUttQixjQUFnQixhQTFDOUUsR0FEQ3pGLEcsb0NBU0QsR0FEQ0EsRyxnQ0FPRCxHQURDQSxHLHFDQ3pDWSxJQUFJa0MsRUFDQyxJQUFJbUMsRUFBWSxVQUNkLElBQUlBLEVBQVksYSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuICAgIC8vQ29tcG9uZW50IEJhc2UgQ2xhc3NcclxuICAgIFxyXG4gICAgZXhwb3J0IGRlZmF1bHQgYWJzdHJhY3QgY2xhc3MgQ29tcG9uZW50PFQgZXh0ZW5kcyBIVE1MRWxlbWVudCwgVSBleHRlbmRzIEhUTUxFbGVtZW50PiB7XHJcbiAgICAgICAgdGVtcGxhdGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50O1xyXG4gICAgICAgIGhvc3RFbGVtZW50OiBUO1xyXG4gICAgICAgIGVsZW1lbnQ6IFU7XHJcbiAgICBcclxuICAgICAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZUlEOiBzdHJpbmcsIGhvc3RFbGVtZW50SWQ6IHN0cmluZywgaW5zZXJ0QXRTdGFydDogYm9vbGVhbiwgbmV3RWxlbWVudElkPzogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGVtcGxhdGVJRCkhIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQgPSAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRJZCkhIGFzIFQ7XHJcbiAgICBcclxuICAgICAgICAgICAgY29uc3QgaW1wb3J0Tm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGltcG9ydE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQgYXMgVTtcclxuICAgICAgICAgICAgaWYgKG5ld0VsZW1lbnRJZCl7XHJcbiAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuaWQgPW5ld0VsZW1lbnRJZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuYXR0YWNoKGluc2VydEF0U3RhcnQpXHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgcHJpdmF0ZSBhdHRhY2ggKGluc2VydEF0QmVnaW5uaW5nOiBib29sZWFuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KGluc2VydEF0QmVnaW5uaW5nID8gJ2FmdGVyYmVnaW4nIDogJ2JlZm9yZWVuZCcsIHRoaXMuZWxlbWVudClcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBhYnN0cmFjdCBjb25maWd1cmUoKTogdm9pZDtcclxuICAgICAgICBhYnN0cmFjdCByZW5kZXJDb250ZW50KCk6IHZvaWQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4iLCIgICAgLy9WYWxpZGF0aW9uXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRhYmxlIHtcclxuICAgICAgICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xyXG4gICAgICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcclxuICAgICAgICBtaW5MZW5ndGg/OiBudW1iZXI7XHJcbiAgICAgICAgbWF4TGVuZ3RoPzogbnVtYmVyO1xyXG4gICAgICAgIG1pbj86IG51bWJlcjtcclxuICAgICAgICBtYXg/OiBudW1iZXI7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZSh2YWxpZGF0YWJsZUlucHV0OiBWYWxpZGF0YWJsZSkge1xyXG4gICAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcclxuICAgICAgICBpZih2YWxpZGF0YWJsZUlucHV0LnJlcXVpcmVkKSB7XHJcbiAgICAgICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoICE9bnVsbCAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoID4gdmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGhcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGggIT1udWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPCB2YWxpZGF0YWJsZUlucHV0Lm1heExlbmd0aFxyXG4gICAgICAgIH1cclxuICAgICAgICBpZih2YWxpZGF0YWJsZUlucHV0Lm1pbiAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09IFwibnVtYmVyXCIpIHtcclxuICAgICAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA+IHZhbGlkYXRhYmxlSW5wdXQubWluXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHZhbGlkYXRhYmxlSW5wdXQubWF4ICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlIDwgdmFsaWRhdGFibGVJbnB1dC5tYXhcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlzVmFsaWRcclxuICAgIH1cclxuICAgICAgICBcclxuIiwiIFxyXG4gICAgICAgIC8vYXV0b2JpbmQgRGVjYXJhdG9yXHJcbiAgICAgICAgZXhwb3J0IGZ1bmN0aW9uIGF1dG9iaW5kKF86IGFueSwgXzI6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcclxuICAgICAgICAgICAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xyXG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZ2V0KCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBib3VuZEZuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhZGpEZXNjcmlwdG9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAiLCIgICAgLy9Qcm9qZWN0IFR5cGVcclxuXHJcblxyXG4gICAgZXhwb3J0IGVudW0gUHJvamVjdFN0YXR1cyB7QWN0aXZlLCBGaW5pc2hlZH1cclxuICAgIFxyXG4gICAgZXhwb3J0IGNsYXNzIFByb2plY3Qge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBpZDogc3RyaW5nLCBwdWJsaWMgdGl0bGU6IHN0cmluZywgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcsIHB1YmxpYyBwZW9wbGU6IG51bWJlciwgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1cykge1xyXG4gICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4iLCJpbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QtbW9kZWwnO1xyXG5cclxuXHJcblxyXG4gICAgIFxyXG4gICAgIC8vUHJvamVjdCBTdGF0ZSBNYW5hZ2VtZW50IFxyXG4gICAgIHR5cGUgTGlzdGVuZXI8VD4gPSAoaXRlbXM6IFRbXSkgPT4gdm9pZDtcclxuICAgICAgICBcclxuICAgICBjbGFzcyBTdGF0ZTxUPiB7XHJcbiAgICAgICAgIHByb3RlY3RlZCBsaXN0ZW5lcnM6IExpc3RlbmVyPFQ+W10gPSBbXTtcclxuICAgICBcclxuICAgICAgICAgYWRkTGlzdGVuZXIobGlzdGVuZXJGbjogTGlzdGVuZXI8VD4pIHtcclxuICAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXJGbilcclxuICAgICAgICAgfVxyXG4gICAgIH1cclxuICAgICBcclxuICAgICBleHBvcnQgY2xhc3MgUHJvamVjdFN0YXRlIGV4dGVuZHMgU3RhdGU8UHJvamVjdD4ge1xyXG4gICAgICAgICBwcml2YXRlIHByb2plY3RzOiBQcm9qZWN0W10gPSBbXTtcclxuICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFByb2plY3RTdGF0ZTtcclxuICAgICBcclxuICAgICAgICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgIH1cclxuICAgICBcclxuICAgICAgICAgc3RhdGljIGdldEluc3RhbmNlKCkge1xyXG4gICAgICAgICAgICAgaWYodGhpcy5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xyXG4gICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgdGhpcy5pbnN0YW5jZSA9IG5ldyBQcm9qZWN0U3RhdGUoKTtcclxuICAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xyXG4gICAgICAgICB9XHJcbiAgICAgXHJcbiAgICAgIFxyXG4gICAgIFxyXG4gICAgIFxyXG4gICAgICAgICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIG51bU9mUGVvcGxlOiBudW1iZXIpIHtcclxuICAgICAgICAgICAgIGNvbnN0IG5ld1Byb2plY3QgPSBuZXcgUHJvamVjdChNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCksIHRpdGxlLCBkZXNjcmlwdGlvbiwgbnVtT2ZQZW9wbGUsIFByb2plY3RTdGF0dXMuQWN0aXZlICk7XHJcbiAgICAgICAgICAgICB0aGlzLnByb2plY3RzLnB1c2gobmV3UHJvamVjdCk7XHJcbiAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlTGlzdGVuZXIoKTtcclxuICAgICAgICAgfVxyXG4gICAgIFxyXG4gICAgICAgICBtb3ZlUHJvamVjdChwcm9qZWN0SUQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XHJcbiAgICAgICAgICAgICBjb25zdCBwcm9qZWN0ID0gdGhpcy5wcm9qZWN0cy5maW5kKHByaiA9PiBwcmouaWQgPT09IHByb2plY3RJRCk7XHJcbiAgICAgICAgICAgICBpZiAocHJvamVjdCAmJiBwcm9qZWN0LnN0YXR1cyAhPSBuZXdTdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICBwcm9qZWN0LnN0YXR1cyA9IG5ld1N0YXR1cztcclxuICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlTGlzdGVuZXIoKTtcclxuICAgICAgICAgICAgIH1cclxuICAgICAgICAgfVxyXG4gICAgIFxyXG4gICAgICAgICBwcml2YXRlIHVwZGF0ZVN0YXRlTGlzdGVuZXIoKSB7XHJcbiAgICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyRm4gb2YgdGhpcy5saXN0ZW5lcnMpIHtcclxuICAgICAgICAgICAgICAgICBsaXN0ZW5lckZuKHRoaXMucHJvamVjdHMuc2xpY2UoKSk7XHJcbiAgICAgICAgICAgICB9XHJcbiAgICAgICAgIH1cclxuICAgICB9XHJcbiAgICAgXHJcbiAgICAgZXhwb3J0IGNvbnN0IHByb2plY3RTdGF0ZSA9IFByb2plY3RTdGF0ZS5nZXRJbnN0YW5jZSgpXHJcbiAiLCJpbXBvcnQgQ21wICBmcm9tICcuL2Jhc2UtY29tcG9uZW50JztcclxuaW1wb3J0ICogYXMgVmFsaWRhdGlvbiBmcm9tICcuLi91dGlsL3ZhbGlkYXRpb24nO1xyXG5pbXBvcnQgeyBhdXRvYmluZCBhcyBBdXRvYmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQtZGVjb3JhdG9yJztcclxuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSAnLi4vc3RhdGUvcHJvamVjdC1zdGF0ZSdcclxuXHJcblxyXG4gICAgLy9Qcm9qZWN0SW5wdXQgQ2xhc3NcclxuICAgIGV4cG9ydCBjbGFzcyBQcm9qZWN0SW5wdXQgZXh0ZW5kcyBDbXA8SFRNTERpdkVsZW1lbnQsIEhUTUxGb3JtRWxlbWVudD4ge1xyXG4gICAgXHJcbiAgICAgICAgdGl0bGVJbnB1dEVsZW1lbnQ6SFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDpIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHBlb3BsZUlucHV0RWxlbWVudDpIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIC8vYnV0dG9uSW5wdXRFbGVtZW50OkhUTUxCdXR0b25FbGVtZW50O1xyXG4gICAgXHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgICAgICBzdXBlcigncHJvamVjdC1pbnB1dCcsICdhcHAnLCB0cnVlLCBcInVzZXItaW5wdXRcIilcclxuICAgICAgICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjdGl0bGUnKSEgYXMgSFRNTElucHV0RWxlbWVudFxyXG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkZXNjcmlwdGlvbicpISBhcyBIVE1MSW5wdXRFbGVtZW50XHJcbiAgICAgICAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwZW9wbGUnKSEgYXMgSFRNTElucHV0RWxlbWVudFxyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlKClcclxuICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25maWd1cmUoKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHRoaXMuc3VibWl0SGFuZGxlcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIHJlbmRlckNvbnRlbnQoKSB7fVxyXG4gICAgXHJcbiAgICAgICAgcHJpdmF0ZSBnYXRoZXJVc2VySW5wdXQoKTogW3N0cmluZywgc3RyaW5nLCBudW1iZXJdIHwgdm9pZCB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVudGVyZWRUaXRsZSA9IHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGVudGVyZWREZXNjcmlwdGlvbiA9IHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGVudGVyZWRQZW9wbGUgPSB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZTtcclxuICAgIFxyXG4gICAgICAgICAgICBjb25zdCB0aXRsZVZhbGlkYXRlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcclxuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRpb25WYWxpZGF0ZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBlbnRlcmVkRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG1pbkxlbmd0aDogNSxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBwZW9wbGVWYWxpZGF0ZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiArZW50ZXJlZFBlb3BsZSxcclxuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgbWluOjAsXHJcbiAgICAgICAgICAgICAgICBtYXg6NVxyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgIVZhbGlkYXRpb24udmFsaWRhdGUodGl0bGVWYWxpZGF0ZSkgfHwgIVZhbGlkYXRpb24udmFsaWRhdGUoZGVzY3JpcHRpb25WYWxpZGF0ZSkgfHwgIVZhbGlkYXRpb24udmFsaWRhdGUocGVvcGxlVmFsaWRhdGUpXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoXCJ2YWxpZGF0aW9uIGZhaWxlZCEgdHJ5IGFnYWluXCIpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbZW50ZXJlZFRpdGxlLCBlbnRlcmVkRGVzY3JpcHRpb24sICtlbnRlcmVkUGVvcGxlXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICBwcml2YXRlIGNsZWFySW5wdXRzKCkge1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIlxyXG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIlxyXG4gICAgICAgICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCJcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBAQXV0b2JpbmRcclxuICAgICAgICBwcml2YXRlIHN1Ym1pdEhhbmRsZXIgKGV2ZW50OiBFdmVudCkge1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpXHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHVzZXJJbnB1dCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzYywgcGVvcGxlXSA9IHVzZXJJbnB1dFxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGl0bGUsIGRlc2MsIHBlb3BsZSk7XHJcbiAgICAgICAgICAgICAgICBwcm9qZWN0U3RhdGUuYWRkUHJvamVjdCh0aXRsZSwgZGVzYywgcGVvcGxlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJJbnB1dHMoKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIFxyXG4gICAgfVxyXG4iLCJcclxuXHJcbmltcG9ydCB7IERyYWdnYWJsZSB9IGZyb20gXCIuLi9tb2RlbHMvZHJhZy1kcm9wLWludGVyZmFjZXNcIlxyXG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QtbW9kZWwnXHJcbmltcG9ydCBDbXAgZnJvbSAnLi9iYXNlLWNvbXBvbmVudCdcclxuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tICcuLi9kZWNvcmF0b3JzL2F1dG9iaW5kLWRlY29yYXRvcidcclxuIFxyXG5cclxuXHJcblxyXG5cclxuICAgIC8vUHJvamVjdEl0ZW0gQ2xhc3NcclxuICAgIFxyXG4gICAgZXhwb3J0IGNsYXNzIFByb2plY3RJdGVtIGV4dGVuZHMgQ21wPEhUTUxVTGlzdEVsZW1lbnQsIEhUTUxMSUVsZW1lbnQ+IGltcGxlbWVudHMgRHJhZ2dhYmxlIHtcclxuICAgICAgICBwcml2YXRlIHByb2plY3Q6IFByb2plY3Q7XHJcbiAgICBcclxuICAgICAgICBnZXQgcGVyc29ucygpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHJvamVjdC5wZW9wbGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcIjEgcGVyc29uXCJcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgY29uc3RydWN0b3IoaG9zdElkOiBzdHJpbmcsIHByb2plY3Q6IFByb2plY3QpIHtcclxuICAgICAgICAgICAgc3VwZXIoJ3NpbmdsZS1wcm9qZWN0JywgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XHJcbiAgICAgICAgICAgIHRoaXMucHJvamVjdCA9IHByb2plY3Q7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlKClcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJDb250ZW50KClcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBAYXV0b2JpbmRcclxuICAgICAgICBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpe1xyXG4gICAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIhLnNldERhdGEoJ3RleHQvcGxhaW4nLCB0aGlzLnByb2plY3QuaWQpO1xyXG4gICAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIhLmVmZmVjdEFsbG93ZWQ9XCJtb3ZlXCI7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgQGF1dG9iaW5kXHJcbiAgICAgICAgZHJhZ0VuZEhhbmRsZXIoXzogRHJhZ0V2ZW50KXtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBjb25maWd1cmUoKXtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0SGFuZGxlcik7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kSGFuZGxlcik7XHJcbiAgICBcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICByZW5kZXJDb250ZW50KCl7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdoMicpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC50aXRsZTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gzJykhLnRleHRDb250ZW50ID0gdGhpcy5wZXJzb25zICsgJyAgYXNzaWduZWQnO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigncCcpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC5kZXNjcmlwdGlvbjtcclxuICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuIiwiXHJcbmltcG9ydCB7IERyYWdUYXJnZXQgfSBmcm9tIFwiLi4vbW9kZWxzL2RyYWctZHJvcC1pbnRlcmZhY2VzXCJcclxuaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gJy4uL21vZGVscy9wcm9qZWN0LW1vZGVsJ1xyXG5pbXBvcnQgQ21wIGZyb20gJy4vYmFzZS1jb21wb25lbnQnXHJcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9hdXRvYmluZC1kZWNvcmF0b3InXHJcbmltcG9ydCB7IHByb2plY3RTdGF0ZSB9IGZyb20gJy4uL3N0YXRlL3Byb2plY3Qtc3RhdGUnXHJcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSAnLi9wcm9qZWN0LWl0ZW0nXHJcblxyXG5cclxuXHJcbiAgICAvL1Byb2plY3RMaXN0IENsYXNzXHJcbiAgICBcclxuICAgIGV4cG9ydCBjbGFzcyBQcm9qZWN0TGlzdCBleHRlbmRzIENtcDxIVE1MRGl2RWxlbWVudCwgSFRNTEVsZW1lbnQ+IGltcGxlbWVudHMgRHJhZ1RhcmdldHtcclxuICAgIFxyXG4gICAgICAgIGFzc2lnbmVkUHJvamVjdHM6IFByb2plY3RbXTtcclxuICAgICAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHR5cGU6ICdhY3RpdmUnIHwgJ2ZpbmlzaGVkJykge1xyXG4gICAgICAgICAgICBzdXBlcigncHJvamVjdC1saXN0JywgJ2FwcCcsIGZhbHNlLGAke3R5cGV9LXByb2plY3RzYCk7XHJcbiAgICAgICAgICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IFtdOyBcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmlkID1gJHt0aGlzLnR5cGV9LXByb2plY3RzYDtcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyUHJvamVjdHMoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGApISBhcyBIVE1MVUxpc3RFbGVtZW50O1xyXG4gICAgICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gJyc7ICBcclxuICAgICAgICAgICAgZm9yIChjb25zdCBwcmpJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xyXG4gICAgICAgICAgICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpIS5pZCwgcHJqSXRlbSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIEBhdXRvYmluZFxyXG4gICAgICAgIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KXtcclxuICAgICAgICAgICAgaWYoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSE7XHJcbiAgICAgICAgICAgICAgICBsaXN0RWwuY2xhc3NMaXN0LmFkZCgnZHJvcHBhYmxlJylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBAYXV0b2JpbmRcclxuICAgICAgICBkcm9wSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KXtcclxuICAgICAgICAgICAgY29uc3QgcHJqSWQgID0gZXZlbnQuZGF0YVRyYW5zZmVyIS5nZXREYXRhKCd0ZXh0L3BsYWluJylcclxuICAgICAgICAgICAgcHJvamVjdFN0YXRlLm1vdmVQcm9qZWN0KHByaklkLCB0aGlzLnR5cGUgPT09IFwiYWN0aXZlXCIgPyBQcm9qZWN0U3RhdHVzLkFjdGl2ZSA6IFByb2plY3RTdGF0dXMuRmluaXNoZWQpO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIEBhdXRvYmluZCBcclxuICAgICAgICBkcmFnTGVhdmVIYW5kbGVyKF86IERyYWdFdmVudCl7XHJcbiAgICBcclxuICAgICAgICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhO1xyXG4gICAgICAgICAgICBsaXN0RWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcHBhYmxlJylcclxuICAgIFxyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgY29uZmlndXJlKCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVySGFuZGxlcik7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnbGVhdmUnLCB0aGlzLmRyYWdMZWF2ZUhhbmRsZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJvcEhhbmRsZXIpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHByb2plY3RTdGF0ZS5hZGRMaXN0ZW5lcigocHJvamVjdHM6IFByb2plY3RbXSk9PntcclxuICAgICAgICAgICAgICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IHByb2plY3RzLmZpbHRlcihwcmogPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJqLnN0YXR1cyA9PT0gUHJvamVjdFN0YXR1cy5BY3RpdmU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyUHJvamVjdHMoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgcmVuZGVyQ29udGVudCgpIHtcclxuICAgICAgICAgICAgY29uc3QgbGlzdElkID0gYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YDtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhLmlkID0gbGlzdElkO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDInKSEudGV4dENvbnRlbnQgPSB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArICcgUFJPSkVDVFMnXHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIH1cclxuIiwiaW1wb3J0IHsgUHJvamVjdElucHV0IH0gZnJvbSAnLi9jb21wb25lbnRzL3Byb2plY3QtaW5wdXQnO1xyXG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gJy4vY29tcG9uZW50cy9wcm9qZWN0LWxpc3QnO1xyXG5cclxuXHJcbiAgICBcclxuICAgIFxyXG4gICAgY29uc3QgcHJqSW5wdXQgPSBuZXcgUHJvamVjdElucHV0KCk7XHJcbiAgICBjb25zdCBhY3RpdmVQcmpMaXN0ID0gbmV3IFByb2plY3RMaXN0KCdhY3RpdmUnKTtcclxuICAgIGNvbnN0IGZpbmlzaGVkUHJqTGlzdCA9IG5ldyBQcm9qZWN0TGlzdCgnZmluaXNoZWQnKTtcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==